<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculate your body fat percentage with our free body fat calculator. Uses multiple methods including US Navy, BMI, and skinfold measurements for accurate results.">
    <meta name="keywords" content="body fat calculator, body fat percentage, body composition, fitness calculator, lean mass, fat mass">
    <meta name="author" content="Sports Tools Hub">
    <meta property="og:title" content="Body Fat Calculator - Free Body Fat Percentage Calculator">
    <meta property="og:description" content="Calculate your body fat percentage using multiple scientifically validated methods">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://leong2599.github.io/sport_tools/tools/body-fat-calculator.html">
    <title>Body Fat Calculator - Free Body Fat Percentage Calculator | Sports Tools Hub</title>
    
    <link rel="canonical" href="https://leong2599.github.io/sport_tools/tools/body-fat-calculator.html">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../tools.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
n    <!-- Header with Navigation -->
    <header class="header">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="../index.html" class="brand-link">
                        <img src="../images/logo.png" alt="Sports Tools Hub Logo" class="brand-logo">
                        <span class="brand-text">Sports Tools Hub</span>
                    </a>
                </div>
                
                <button class="nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                </button>
                
                <ul class="nav-menu" role="menubar">
                    <li class="nav-item" role="none">
                        <a href="../index.html" class="nav-link" role="menuitem">Home</a>
                    </li>
                    <li class="nav-item dropdown" role="none">
                        <a href="#tools" class="nav-link dropdown-toggle" role="menuitem" aria-haspopup="true" aria-expanded="false">Tools</a>
                        <ul class="dropdown-menu" role="menu">
                            <li role="none"><a href="../index.html#fitness-calculators" class="dropdown-item" role="menuitem">Fitness Calculators</a></li>
                            <li role="none"><a href="../index.html#performance-trackers" class="dropdown-item" role="menuitem">Performance Trackers</a></li>
                            <li role="none"><a href="../index.html#nutrition-tools" class="dropdown-item" role="menuitem">Nutrition Tools</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </header>



    <!-- Main Content -->
    <main id="main-content">
        <!-- Tool Hero Section -->
        <section class="tool-hero" aria-labelledby="tool-title">
            <div class="container">
                <h1 id="tool-title">Body Fat Calculator</h1>
                <p class="tool-subtitle">Calculate your body fat percentage using multiple scientifically validated methods for accurate body composition analysis</p>
            </div>
        </section>

        <!-- Calculator Section -->
        <section class="calculator-section">
            <div class="container">
                <div class="calculator-layout">
                    <!-- Calculator Form -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Calculate Your Body Fat</h2>
                        </div>
                        <form id="body-fat-form" class="calculator-form" aria-labelledby="body-fat-form-title">
                            <h3 id="body-fat-form-title" class="sr-only">Body Fat Calculation Form</h3>
                            
                            <div class="form-group">
                                <label for="method">Calculation Method</label>
                                <select id="method" name="method" required aria-describedby="method-help">
                                    <option value="">Select calculation method</option>
                                    <option value="us-navy">US Navy Method</option>
                                    <option value="bmi">BMI-Based Method</option>
                                    <option value="skinfold">Skinfold Method</option>
                                </select>
                                <small id="method-help">Choose your preferred calculation method</small>
                            </div>

                            <!-- Common fields -->
                            <div class="form-group">
                                <fieldset>
                                    <legend>Gender</legend>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="gender" value="male" required>
                                            <span>Male</span>
                                        </label>
                                        <label>
                                            <input type="radio" name="gender" value="female" required>
                                            <span>Female</span>
                                        </label>
                                    </div>
                                </fieldset>
                            </div>

                            <div class="form-group">
                                <label for="age">Age</label>
                                <input type="number" id="age" name="age" min="18" max="100" required 
                                       aria-describedby="age-help" placeholder="Enter your age">
                                <small id="age-help">Enter your age in years</small>
                            </div>

                            <div class="form-group">
                                <label for="weight">Weight</label>
                                <div class="input-group">
                                    <input type="number" id="weight" name="weight" step="0.1" min="30" required 
                                           aria-describedby="weight-help" placeholder="Enter your weight">
                                    <select id="weight-unit" name="weight-unit" aria-label="Weight unit">
                                        <option value="kg">kg</option>
                                        <option value="lbs">lbs</option>
                                    </select>
                                </div>
                                <small id="weight-help">Enter your body weight</small>
                            </div>

                            <div class="form-group">
                                <label for="height">Height</label>
                                <div class="input-group height-input-group">
                                    <input type="number" id="heightCm" name="heightCm" step="0.1" min="50" placeholder="cm">
                                    <div class="height-feet-inches">
                                        <input type="number" id="heightFeet" name="heightFeet" min="1" placeholder="ft">
                                        <input type="number" id="heightInches" name="heightInches" min="0" max="11" placeholder="in">
                                    </div>
                                    <select id="height-unit" name="height-unit" aria-label="Height unit">
                                        <option value="cm">cm</option>
                                        <option value="ft">ft/in</option>
                                    </select>
                                </div>
                                <small id="height-help">Enter your height</small>
                            </div>

                            <!-- US Navy Method Fields -->
                            <div id="us-navy-fields" class="method-fields" style="display: none;">
                                <h4>US Navy Method Measurements</h4>
                                <div class="form-group">
                                    <label for="neck">Neck Circumference</label>
                                    <div class="input-group">
                                        <input type="number" id="neck" name="neck" step="0.1" min="20" 
                                               aria-describedby="neck-help" placeholder="Neck circumference">
                                        <select id="neck-unit" name="neck-unit" aria-label="Neck unit">
                                            <option value="cm">cm</option>
                                            <option value="in">inches</option>
                                        </select>
                                    </div>
                                    <small id="neck-help">Measure at the narrowest point</small>
                                </div>

                                <div class="form-group" id="waist-group">
                                    <label for="waist">Waist Circumference</label>
                                    <div class="input-group">
                                        <input type="number" id="waist" name="waist" step="0.1" min="50" 
                                               aria-describedby="waist-help" placeholder="Waist circumference">
                                        <select id="waist-unit" name="waist-unit" aria-label="Waist unit">
                                            <option value="cm">cm</option>
                                            <option value="in">inches</option>
                                        </select>
                                    </div>
                                    <small id="waist-help">Measure at the navel level</small>
                                </div>

                                <div class="form-group" id="hip-group" style="display: none;">
                                    <label for="hip">Hip Circumference</label>
                                    <div class="input-group">
                                        <input type="number" id="hip" name="hip" step="0.1" min="70" 
                                               aria-describedby="hip-help" placeholder="Hip circumference">
                                        <select id="hip-unit" name="hip-unit" aria-label="Hip unit">
                                            <option value="cm">cm</option>
                                            <option value="in">inches</option>
                                        </select>
                                    </div>
                                    <small id="hip-help">Measure at the widest point</small>
                                </div>
                            </div>

                            <!-- Skinfold Method Fields -->
                            <div id="skinfold-fields" class="method-fields" style="display: none;">
                                <h4>Skinfold Measurements (mm)</h4>
                                <p class="method-description">Use calipers to measure skinfold thickness in millimeters</p>
                                
                                <div class="form-group">
                                    <label for="chest">Chest Skinfold</label>
                                    <input type="number" id="chest" name="chest" step="0.1" min="1" max="50" 
                                           placeholder="Chest measurement in mm">
                                </div>

                                <div class="form-group">
                                    <label for="abdominal">Abdominal Skinfold</label>
                                    <input type="number" id="abdominal" name="abdominal" step="0.1" min="1" max="50" 
                                           placeholder="Abdominal measurement in mm">
                                </div>

                                <div class="form-group">
                                    <label for="thigh">Thigh Skinfold</label>
                                    <input type="number" id="thigh" name="thigh" step="0.1" min="1" max="50" 
                                           placeholder="Thigh measurement in mm">
                                </div>

                                <div class="form-group female-only" style="display: none;">
                                    <label for="triceps">Triceps Skinfold</label>
                                    <input type="number" id="triceps" name="triceps" step="0.1" min="1" max="50" 
                                           placeholder="Triceps measurement in mm">
                                </div>

                                <div class="form-group female-only" style="display: none;">
                                    <label for="suprailiac">Suprailiac Skinfold</label>
                                    <input type="number" id="suprailiac" name="suprailiac" step="0.1" min="1" max="50" 
                                           placeholder="Suprailiac measurement in mm">
                                </div>
                            </div>

                            <div class="button-group">
                                <button type="submit" class="btn btn-primary">Calculate Body Fat</button>
                                <button type="reset" class="btn btn-secondary">Reset</button>
                            </div>
                        </form>
                    </div>

                    <!-- Results Section -->
                    <div class="card results-card" id="body-fat-results">
                        <div class="card-header">
                            <h2 class="card-title">Your Body Fat Results</h2>
                        </div>
                        
                        <div class="results-display">
                            <div id="bf-percentage" class="results-value">--</div>
                            <div id="bf-category" class="results-category">--</div>
                        </div>

                        <div class="results-breakdown">
                            <h3>Body Composition</h3>
                            <div class="composition-grid">
                                <div class="comp-item">
                                    <div class="comp-label">Fat Mass</div>
                                    <div class="comp-value" id="fat-mass">--</div>
                                </div>
                                <div class="comp-item">
                                    <div class="comp-label">Lean Mass</div>
                                    <div class="comp-value" id="lean-mass">--</div>
                                </div>
                            </div>
                        </div>

                        <div class="results-chart">
                            <h3>Body Fat Categories</h3>
                            <div class="bf-ranges" id="bf-ranges">
                                <!-- Categories will be populated based on gender -->
                            </div>
                        </div>

                        <div class="results-recommendations">
                            <h3>Recommendations</h3>
                            <div id="recommendation-text" class="recommendation-content">
                                <!-- Recommendations will be inserted here -->
                            </div>
                        </div>

                        <div class="results-actions">
                            <button class="btn btn-secondary" onclick="window.print()">Print Results</button>
                            <button class="btn btn-primary" onclick="shareResults()">Share Results</button>
                        </div>
                    </div>
                </div>

                <!-- Body Fat Information -->
                <div class="card info-card">
                    <div class="card-header">
                        <h2 class="card-title">About Body Fat Calculation</h2>
                    </div>
                    <p>Body fat percentage is a key health metric that provides insight into your body composition beyond just weight.</p>
                    
                    <h3>Calculation Methods</h3>
                    <ul>
                        <li><strong>US Navy Method:</strong> Uses circumference measurements for good accuracy</li>
                        <li><strong>BMI-Based Method:</strong> Simple estimation using BMI, less accurate</li>
                        <li><strong>Skinfold Method:</strong> Uses caliper measurements, most accurate when done properly</li>
                    </ul>
                    
                    <h3>Measurement Tips</h3>
                    <ul>
                        <li>Take measurements in the morning before eating</li>
                        <li>Use a flexible measuring tape for circumference measurements</li>
                        <li>Measure at the same locations consistently</li>
                        <li>For skinfold measurements, use proper calipers</li>
                        <li>Take multiple measurements and use the average</li>
                    </ul>
                    
                    <h3>Healthy Body Fat Ranges</h3>
                    <div class="healthy-ranges">
                        <h4>Men:</h4>
                        <ul>
                            <li>Athletes: 6-13%</li>
                            <li>Fitness: 14-17%</li>
                            <li>Acceptable: 18-24%</li>
                            <li>Obese: 25%+</li>
                        </ul>
                        
                        <h4>Women:</h4>
                        <ul>
                            <li>Athletes: 14-20%</li>
                            <li>Fitness: 21-24%</li>
                            <li>Acceptable: 25-31%</li>
                            <li>Obese: 32%+</li>
                        </ul>
                    </div>
                    
                    <h3>Limitations</h3>
                    <ul>
                        <li>These are estimates, not clinical measurements</li>
                        <li>Hydration levels can affect measurements</li>
                        <li>Individual variations in body composition</li>
                        <li>Consult professionals for medical assessments</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

        <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Sports Tools Hub</h4>
                    <p>Your comprehensive resource for sports calculators, fitness trackers, training guides, and expert insights.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Fitness Calculators</h4>
                    <nav>
                        <ul class="footer-links">
                            <li><a href="#https://leong2599.github.io/sport_tools/tools/bmi-calculator.html">BMI Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/one-rep-max-calculator.html">One Rep Max Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/calorie-calculator.html">Calorie Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/heart-rate-calculator.html">Heart Rate Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/body-type-quiz.html">Body Type Quiz</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/body-fat-calculator.html">Body Fat Calculator</a></li>
                        </ul>
                    </nav>
                </div>
                
                <div class="footer-section">
                    <h4>Performance Trackers</h4>
                    <nav>
                        <ul class="footer-links">
                            <li><a href="https://leong2599.github.io/sport_tools/tools/cycling-power.html">Cycling Power Tracker</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/pace-calculator.html">Pace Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/swim-pace.html">Swim Pace Calculator</a></li>
                        </ul>
                    </nav>
                </div>

                <div class="footer-section">
                    <h4>Nutrition Tools</h4>
                    <nav>
                        <ul class="footer-links">
                            <li><a href="https://leong2599.github.io/sport_tools/tools/protein-calculator.html">Protein Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/tdee-calculator.html">TDEE Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/hydration-calculator.html">Hydration Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/macronutrient-calculator.html">Macro Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/bmr-calculator.html">BMR Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/lean-body-mass-calculator.html">Lean Body Mass Calculator</a></li>
                            <li><a href="https://leong2599.github.io/sport_tools/tools/meal-timing.html">Meal Timing Calculator</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 Sports Tools Hub. All rights reserved. | <a href="/sitemap.xml">Sitemap</a> </p>
            </div>
        </div>
    </footer>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // --- DOM Elements ---
                const methodSelect = document.getElementById('method');
                const genderRadios = document.querySelectorAll('input[name="gender"]');
                const ageInput = document.getElementById('age');
                const weightInput = document.getElementById('weight');
                const weightUnitSelect = document.getElementById('weight-unit');
                const heightCmInput = document.getElementById('heightCm');
                const heightFeetInput = document.getElementById('heightFeet');
                const heightInchesInput = document.getElementById('heightInches');
                const heightUnitSelect = document.getElementById('height-unit');
                const neckInput = document.getElementById('neck');
                const neckUnitSelect = document.getElementById('neck-unit');
                const waistInput = document.getElementById('waist');
                const waistUnitSelect = document.getElementById('waist-unit');
                const hipInput = document.getElementById('hip');
                const hipUnitSelect = document.getElementById('hip-unit');
                const chestInput = document.getElementById('chest');
                const abdominalInput = document.getElementById('abdominal');
                const thighInput = document.getElementById('thigh');
                const tricepsInput = document.getElementById('triceps');
                const suprailiacInput = document.getElementById('suprailiac');
    
                // Method-specific field containers
                const usNavyFields = document.getElementById('us-navy-fields');
                const skinfoldFields = document.getElementById('skinfold-fields');
                const hipGroup = document.getElementById('hip-group');
                const femaleOnlySkinfoldFields = document.querySelectorAll('.female-only');
    
                const bfResultsCard = document.getElementById('body-fat-results');
    
                // --- Utility Functions ---
                function getInputValue(element) {
                    return element ? parseFloat(element.value) : NaN;
                }
    
                function getSelectedUnit(element) {
                    return element ? element.value : '';
                }
    
                // --- Toggle Field Visibility & Required Attributes ---
                function toggleMethodFields() {
                    // Hide all and remove required
                    [usNavyFields, skinfoldFields].forEach(fieldGroup => {
                        fieldGroup.style.display = 'none';
                        fieldGroup.querySelectorAll('input').forEach(input => input.removeAttribute('required'));
                    });
    
                    const selectedMethod = methodSelect.value;
                    const gender = document.querySelector('input[name="gender"]:checked')?.value;
    
                    if (selectedMethod === 'us-navy') {
                        usNavyFields.style.display = 'block';
                        neckInput.setAttribute('required', 'required');
                        waistInput.setAttribute('required', 'required');
                        if (gender === 'female') {
                            hipInput.setAttribute('required', 'required');
                        }
                    } else if (selectedMethod === 'skinfold') {
                        skinfoldFields.style.display = 'block';
                        thighInput.setAttribute('required', 'required');
                        if (gender === 'male') {
                            chestInput.setAttribute('required', 'required');
                            abdominalInput.setAttribute('required', 'required');
                        } else { // female
                            tricepsInput.setAttribute('required', 'required');
                            suprailiacInput.setAttribute('required', 'required');
                        }
                    }
                    toggleGenderSpecificFields(); // Ensure hip field visibility is correct
                }
    
                function toggleGenderSpecificFields() {
                    const gender = document.querySelector('input[name="gender"]:checked')?.value;
                    const selectedMethod = methodSelect.value;
    
                    // Reset all gender-specific fields' visibility and required status first
                    femaleOnlySkinfoldFields.forEach(field => {
                        field.style.display = 'none';
                        field.querySelectorAll('input').forEach(input => input.removeAttribute('required'));
                    });
                    hipGroup.style.display = 'none';
                    hipInput.removeAttribute('required');
    
                    chestInput.removeAttribute('required');
                    abdominalInput.removeAttribute('required');
                    tricepsInput.removeAttribute('required');
                    suprailiacInput.removeAttribute('required');
    
                    if (gender === 'female') {
                        if (selectedMethod === 'us-navy') {
                            hipGroup.style.display = 'block';
                            hipInput.setAttribute('required', 'required');
                        } else if (selectedMethod === 'skinfold') {
                            femaleOnlySkinfoldFields.forEach(field => field.style.display = 'block');
                            tricepsInput.setAttribute('required', 'required');
                            suprailiacInput.setAttribute('required', 'required');
                            thighInput.setAttribute('required', 'required'); // Ensure thigh is still required
                        }
                    } else if (gender === 'male') {
                        if (selectedMethod === 'skinfold') {
                            chestInput.setAttribute('required', 'required');
                            abdominalInput.setAttribute('required', 'required');
                            thighInput.setAttribute('required', 'required'); // Ensure thigh is still required
                        }
                    }
                }
    
                function toggleHeightInputs() {
                    if (heightUnitSelect.value === 'cm') {
                        heightCmInput.style.display = 'block';
                        heightCmInput.setAttribute('required', 'required');
                        heightFeetInput.style.display = 'none';
                        heightFeetInput.removeAttribute('required');
                        heightInchesInput.style.display = 'none';
                        heightInchesInput.removeAttribute('required');
                    } else { // ft/in
                        heightCmInput.style.display = 'none';
                        heightCmInput.removeAttribute('required');
                        heightFeetInput.style.display = 'block';
                        heightFeetInput.setAttribute('required', 'required');
                        heightInchesInput.style.display = 'block';
                        heightInchesInput.setAttribute('required', 'required');
                    }
                }
    
                // --- Event Listeners ---
                methodSelect.addEventListener('change', toggleMethodFields);
                genderRadios.forEach(radio => radio.addEventListener('change', toggleGenderSpecificFields));
                heightUnitSelect.addEventListener('change', toggleHeightInputs);
    
                // Initial setup
                toggleHeightInputs();
                toggleMethodFields();
                toggleGenderSpecificFields(); // Call initially to set correct state
                
                // Set initial 'radio-selected' class for gender radio buttons
                document.querySelectorAll('.radio-group input[name="gender"]:checked').forEach(radio => {
                    radio.closest('label').classList.add('radio-selected');
                });
                // Add event listeners to radio buttons for styling
                document.querySelectorAll('.radio-group input[name="gender"]').forEach(radio => {
                    radio.addEventListener('change', () => {
                        document.querySelectorAll('.radio-group input[name="gender"]').forEach(siblingRadio => {
                            siblingRadio.closest('label').classList.remove('radio-selected');
                        });
                        if (radio.checked) {
                            radio.closest('label').classList.add('radio-selected');
                        }
                    });
                });
    
                document.getElementById('body-fat-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    calculateBodyFat();
                });
    
                document.getElementById('body-fat-form').addEventListener('reset', function() {
                    // Reset fields
                    document.getElementById('bf-percentage').textContent = '--';
                    document.getElementById('bf-category').textContent = '--';
                    document.getElementById('fat-mass').textContent = '--';
                    document.getElementById('lean-mass').textContent = '--';
                    document.getElementById('bf-ranges').innerHTML = '';
                    document.getElementById('recommendation-text').textContent = '';
                    
                    bfResultsCard.classList.remove('show');
                    bfResultsCard.style.display = 'none';
    
                    // Reset field visibility and required attributes
                    methodSelect.value = ''; // Reset method dropdown
                    toggleMethodFields(); // This will also handle required attributes
                    toggleHeightInputs();
                    toggleGenderSpecificFields();
                    // Clear radio-selected class
                    document.querySelectorAll('.radio-group input[name="gender"]').forEach(radio => {
                        radio.closest('label').classList.remove('radio-selected');
                    });
                });
    
    
                function calculateBodyFat() {
                    // Get common input values
                    const method = methodSelect.value;
                    const gender = document.querySelector('input[name="gender"]:checked')?.value;
                    const age = getInputValue(ageInput);
                    const weight = getInputValue(weightInput);
                    const weightUnit = getSelectedUnit(weightUnitSelect);
                    const heightUnit = getSelectedUnit(heightUnitSelect);
    
                    // --- Input Validation ---
                    if (!method) { alert('Please select a calculation method.'); return; }
                    if (!gender) { alert('Please select your gender.'); return; }
                    if (isNaN(age) || age < 18 || age > 100) { alert('Please enter a valid age (18-100).'); return; }
                    if (isNaN(weight) || weight < 30) { alert('Please enter a valid weight (min 30).'); return; }
    
                    let heightCm;
                    if (heightUnit === 'cm') {
                        heightCm = getInputValue(heightCmInput);
                        if (isNaN(heightCm) || heightCm < 50 || heightCm > 300) { alert('Please enter a valid height in cm (50-300).'); return; }
                    } else { // ft/in
                        const feet = getInputValue(heightFeetInput);
                        const inches = getInputValue(heightInchesInput);
                        if (isNaN(feet) || feet < 1 || feet > 9 || isNaN(inches) || inches < 0 || inches > 11) { alert('Please enter a valid height in feet (1-9) and inches (0-11).'); return; }
                        heightCm = (feet * 30.48) + (inches * 2.54);
                    }
    
                    // Convert weight to kg if in lbs
                    let weightKg = weight;
                    if (weightUnit === 'lbs') {
                        weightKg = weight * 0.453592;
                    }
    
                    let bodyFatPercentage;
    
                    // --- Calculate based on method ---
                    if (method === 'us-navy') {
                        const neck = getInputValue(neckInput);
                        const waist = getInputValue(waistInput);
                        let hip = 0; // Only for females
    
                        if (isNaN(neck) || neck <= 0) { alert('Please enter a valid neck circumference.'); return; }
                        if (isNaN(waist) || waist <= 0) { alert('Please enter a valid waist circumference.'); return; }
                        if (gender === 'female') {
                            hip = getInputValue(hipInput);
                            if (isNaN(hip) || hip <= 0) { alert('Please enter a valid hip circumference.'); return; }
                        }
    
                        bodyFatPercentage = calculateUSNavy(gender, heightCm, neck, waist, hip, getSelectedUnit(neckUnitSelect), getSelectedUnit(waistUnitSelect), getSelectedUnit(hipUnitSelect));
                    } else if (method === 'bmi') {
                        bodyFatPercentage = calculateBMIBased(gender, weightKg, heightCm, age);
                    } else if (method === 'skinfold') {
                        const thigh = getInputValue(thighInput);
                        if (isNaN(thigh) || thigh <= 0) { alert('Please enter a valid thigh skinfold measurement.'); return; }
    
                        if (gender === 'male') {
                            const chest = getInputValue(chestInput);
                            const abdominal = getInputValue(abdominalInput);
                            if (isNaN(chest) || chest <= 0) { alert('Please enter a valid chest skinfold measurement.'); return; }
                            if (isNaN(abdominal) || abdominal <= 0) { alert('Please enter a valid abdominal skinfold measurement.'); return; }
                            bodyFatPercentage = calculateSkinfoldMale(age, chest, abdominal, thigh);
                        } else { // female
                            const triceps = getInputValue(tricepsInput);
                            const suprailiac = getInputValue(suprailiacInput);
                            if (isNaN(triceps) || triceps <= 0) { alert('Please enter a valid triceps skinfold measurement.'); return; }
                            if (isNaN(suprailiac) || suprailiac <= 0) { alert('Please enter a valid suprailiac skinfold measurement.'); return; }
                            bodyFatPercentage = calculateSkinfoldFemale(age, triceps, suprailiac, thigh);
                        }
                    }
    
                    if (isNaN(bodyFatPercentage) || bodyFatPercentage < 0 || bodyFatPercentage > 100) {
                        alert('Could not calculate body fat. Please check your inputs and ensure they are realistic.');
                        return;
                    }
    
                    // Calculate body composition
                    const fatMassKg = weightKg * (bodyFatPercentage / 100);
                    const leanMassKg = weightKg - fatMassKg;
    
                    // Get category
                    const category = getBodyFatCategory(gender, bodyFatPercentage);
    
                    // Display results
                    document.getElementById('bf-percentage').textContent = bodyFatPercentage.toFixed(1) + '%';
                    document.getElementById('bf-category').textContent = category;
                    document.getElementById('fat-mass').textContent = fatMassKg.toFixed(1) + ' kg';
                    document.getElementById('lean-mass').textContent = leanMassKg.toFixed(1) + ' kg';
    
                    // Display categories chart
                    displayBodyFatCategories(gender, bodyFatPercentage);
    
                    // Generate recommendations
                    const recommendations = generateRecommendations(gender, bodyFatPercentage, age);
                    document.getElementById('recommendation-text').textContent = recommendations;
    
                    // Show results section
                    bfResultsCard.style.display = 'block';
                    bfResultsCard.classList.add('show');
    
                    // Scroll to results
                    bfResultsCard.scrollIntoView({ behavior: 'smooth' });
    
                    // Track usage
                    if (window.calculatorUtils) {
                        window.calculatorUtils.trackToolUsage('Body Fat Calculator');
                    }
                }
    
                // --- Calculation Formulas ---
                function calculateUSNavy(gender, heightCm, neck, waist, hip, neckUnit, waistUnit, hipUnit) {
                    // Convert to inches for formula, then convert back to cm if needed for parameters, or simply apply formula for cm if available.
                    // The existing formula seems to be a hybrid or adapted one. Let's ensure consistency.
                    // A common US Navy formula uses measurements in inches. We will convert all to inches first.
                    const heightIn = heightCm / 2.54;
                    const neckIn = (neckUnit === 'cm' ? neck / 2.54 : neck);
                    const waistIn = (waistUnit === 'cm' ? waist / 2.54 : waist);
                    const hipIn = (hipUnit === 'cm' ? hip / 2.54 : hip);
    
                    let bodyFatPercentage;
                    if (gender === 'male') {
                        // Male US Navy Formula (in inches):
                        // BF% = 86.010 * log10(waist - neck) - 70.041 * log10(height) + 36.76
                        // This formula is simplified. The original includes constants and different log terms.
                        // Let's use the standard simplified formula for inches
                        const val1 = waistIn - neckIn;
                        if (val1 <= 0) return NaN; // Prevent Math.log10(<=0)
                        bodyFatPercentage = 86.010 * Math.log10(val1) - 70.041 * Math.log10(heightIn) + 36.76;
                    } else { // female
                        // Female US Navy Formula (in inches):
                        // BF% = 163.205 * log10(waist + hip - neck) - 97.684 * log10(height) - 78.387
                        const val1 = waistIn + hipIn - neckIn;
                        if (val1 <= 0) return NaN; // Prevent Math.log10(<=0)
                        bodyFatPercentage = 163.205 * Math.log10(val1) - 97.684 * Math.log10(heightIn) - 78.387;
                    }
                    return bodyFatPercentage;
                }
    
                function calculateBMIBased(gender, weightKg, heightCm, age) {
                    const bmi = weightKg / Math.pow(heightCm / 100, 2);
                    
                    let bodyFatPercentage;
                    if (gender === 'male') {
                        bodyFatPercentage = (1.20 * bmi) + (0.23 * age) - 16.2;
                    } else {
                        bodyFatPercentage = (1.20 * bmi) + (0.23 * age) - 5.4;
                    }
                    return bodyFatPercentage;
                }
    
                function calculateSkinfoldMale(age, chest, abdominal, thigh) {
                    const sumSkinfolds = chest + abdominal + thigh;
                    // Durnin-Womersley or Jackson-Pollock 3-site for men
                    // Using Jackson-Pollock 3-site for consistency with formula structure
                    const bodyDensity = 1.10938 - (0.0008267 * sumSkinfolds) + (0.0000016 * sumSkinfolds * sumSkinfolds) - (0.0002574 * age);
                    return ((4.95 / bodyDensity) - 4.5) * 100;
                }
    
                function calculateSkinfoldFemale(age, triceps, suprailiac, thigh) {
                    const sumSkinfolds = triceps + suprailiac + thigh;
                    // Jackson-Pollock 3-site for women
                    const bodyDensity = 1.0994921 - (0.0009929 * sumSkinfolds) + (0.0000023 * sumSkinfolds * sumSkinfolds) - (0.0001392 * age);
                    return ((4.95 / bodyDensity) - 4.5) * 100;
                }
    
                function getBodyFatCategory(gender, percentage) {
                    if (gender === 'male') {
                        if (percentage < 6) return 'Essential Fat';
                        if (percentage < 14) return 'Athletes';
                        if (percentage < 18) return 'Fitness';
                        if (percentage < 25) return 'Acceptable';
                        return 'Obese';
                    } else {
                        if (percentage < 14) return 'Essential Fat';
                        if (percentage < 21) return 'Athletes';
                        if (percentage < 25) return 'Fitness';
                        if (percentage < 32) return 'Acceptable';
                        return 'Obese';
                    }
                }
    
                function displayBodyFatCategories(gender, currentPercentage) {
                    const rangesContainer = document.getElementById('bf-ranges');
                    rangesContainer.innerHTML = '';
    
                    const ranges = gender === 'male' ? 
                        [
                            { name: 'Essential Fat', min: 0, max: 6, color: '#3b82f6' },
                            { name: 'Athletes', min: 6, max: 14, color: '#10b981' },
                            { name: 'Fitness', min: 14, max: 18, color: '#f59e0b' },
                            { name: 'Acceptable', min: 18, max: 25, color: '#f97316' },
                            { name: 'Obese', min: 25, max: 100, color: '#ef4444' } // Max 100 for display
                        ] :
                        [
                            { name: 'Essential Fat', min: 0, max: 14, color: '#3b82f6' },
                            { name: 'Athletes', min: 14, max: 21, color: '#10b981' },
                            { name: 'Fitness', min: 21, max: 25, color: '#f59e0b' },
                            { name: 'Acceptable', min: 25, max: 32, color: '#f97316' },
                            { name: 'Obese', min: 32, max: 100, color: '#ef4444' } // Max 100 for display
                        ];
    
                    ranges.forEach(range => {
                        const rangeItem = document.createElement('div');
                        rangeItem.className = 'range-item';
                        rangeItem.style.background = range.color;
                        rangeItem.style.color = 'white';
                        
                        // Highlight the current category
                        if (currentPercentage >= range.min && currentPercentage < range.max) {
                            rangeItem.style.border = '3px solid var(--text-dark)'; // Use a variable
                            rangeItem.style.fontWeight = 'bold';
                            rangeItem.style.transform = 'scale(1.02)';
                        }
                        
                        rangeItem.innerHTML = `
                            <span class="range-label">${range.name}</span>
                            <span class="range-value">${range.min}${range.max === 100 ? '+' : '-' + range.max}%</span>
                        `;
                        
                        rangesContainer.appendChild(rangeItem);
                    });
                }
    
                function generateRecommendations(gender, percentage, age) {
                    const category = getBodyFatCategory(gender, percentage);
                    let recommendations = '';
    
                    switch(category) {
                        case 'Essential Fat':
                            recommendations = 'Your body fat percentage is at essential levels. This is typical for elite athletes but may be too low for general health. Ensure adequate nutrition and consider consulting a sports nutritionist.';
                            break;
                        case 'Athletes':
                            recommendations = 'Excellent! You have an athletic body fat percentage. Maintain your current training and nutrition regimen. Focus on performance and recovery.';
                            break;
                        case 'Fitness':
                            recommendations = 'Great job! You\'re in the fitness range. Continue with balanced nutrition and regular exercise. Consider strength training to maintain lean mass.';
                            break;
                        case 'Acceptable':
                            recommendations = 'You\'re in a healthy range. For optimal fitness, consider incorporating more strength training and cardiovascular exercise. Focus on nutrient-dense foods.';
                            break;
                        case 'Obese':
                            recommendations = 'Consider a structured approach to reduce body fat through a combination of caloric deficit, regular exercise (both cardio and strength training), and adequate protein. Consult healthcare professionals for personalized guidance.';
                            break;
                    }
    
                    return recommendations;
                }
    
                function shareResults() {
                    const percentage = document.getElementById('bf-percentage').textContent;
                    const category = document.getElementById('bf-category').textContent;
                    const text = `My body fat percentage is ${percentage} (${category}). Calculate yours at Sports Tools Hub!`;
                    
                    if (navigator.share) {
                        navigator.share({
                            title: 'Body Fat Calculator Results',
                            text: text,
                            url: window.location.href
                        });
                    } else {
                        // Fallback - copy to clipboard
                        navigator.clipboard.writeText(text + ' ' + window.location.href);
                        alert('Results copied to clipboard!');
                    }
                }
    
                // Accessibility: Set focus on result when shown
                const observer = new MutationObserver((mutationsList, observer) => {
                    for(let mutation of mutationsList) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (bfResultsCard.classList.contains('show')) {
                                document.getElementById('bf-percentage').focus();
                            }
                        }
                    }
                });
                observer.observe(bfResultsCard, { attributes: true });
    
            }); // End DOMContentLoaded
        </script></body>
</html>